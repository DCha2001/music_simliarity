# Music Similarity Search

A full-stack application that finds similar songs using audio embeddings and vector similarity search. Built with FastAPI, PostgreSQL (pgvector), and Next.js.

## Overview

This project enables semantic music search by converting audio files into high-dimensional embeddings using the OpenL3 model. Users can search for a song and receive recommendations for similar tracks based on acoustic features rather than metadata or collaborative filtering.

### Key Features

- **Audio Embedding Generation**: Uses OpenL3 to generate 512-dimensional audio embeddings
- **Vector Similarity Search**: Leverages PostgreSQL's pgvector extension for efficient L2 distance calculations
- **RESTful API**: FastAPI backend with automatic OpenAPI documentation
- **Modern Frontend**: Next.js 15 with TypeScript and Tailwind CSS
- **Containerized Architecture**: Docker Compose orchestration for easy deployment
- **FMA Dataset Integration**: Works with Free Music Archive dataset

## Architecture

```
┌─────────────┐      ┌─────────────┐      ┌──────────────┐
│   Next.js   │─────▶│   FastAPI   │─────▶│  PostgreSQL  │
│  Frontend   │      │   Backend   │      │  + pgvector  │
│  (Port 3000)│      │ (Port 8000) │      │  (Port 5432) │
└─────────────┘      └─────────────┘      └──────────────┘
```

### Tech Stack

**Backend**
- FastAPI 0.115+ - High-performance Python web framework
- SQLAlchemy 2.0+ - SQL toolkit and ORM
- pgvector 0.4+ - PostgreSQL extension for vector operations
- OpenL3 0.4+ - Deep audio embedding model
- librosa 0.10+ - Audio analysis library
- TensorFlow 2.15+ - ML framework for OpenL3

**Frontend**
- Next.js 15.5+ - React framework
- TypeScript 5+ - Type-safe JavaScript
- Tailwind CSS 4+ - Utility-first CSS framework
- React 19.1+ - UI library

**Database**
- PostgreSQL 17 with pgvector extension

## Getting Started

### Prerequisites

- Docker and Docker Compose
- Git

### Installation

1. Clone the repository
```bash
git clone https://github.com/DCha2001/music_similarity.git
cd MusicSimilarity
```

2. Download the FMA dataset (optional)
```bash
# Download fma_small (8,000 tracks, 30s clips, 7.2GB)
# Place audio files in: backend/app/data/fma_small/
```

3. Start the application
```bash
docker-compose up --build
```

The services will be available at:
- Frontend: http://localhost:3000
- Backend API: http://localhost:8000
- API Documentation: http://localhost:8000/docs
- PostgreSQL: localhost:5432

## Project Structure

```
MusicSimilarity/
├── backend/
│   ├── app/
│   │   ├── db/
│   │   │   ├── db.py              # Database connection
│   │   │   └── models.py          # SQLAlchemy models
│   │   ├── routes/
│   │   │   └── search.py          # Search endpoints
│   │   ├── services/
│   │   │   ├── embeddings.py      # OpenL3 embedding generation
│   │   │   └── find_similar_songs.py
│   │   ├── utils/
│   │   │   ├── dependencies.py
│   │   │   └── getFM.py           # FMA dataset utilities
│   │   ├── main.py                # FastAPI app entry point
│   │   └── populate_db.py         # Database population script
│   ├── requirements.txt
│   └── Dockerfile
├── frontend/
│   ├── app/
│   │   ├── page.tsx               # Main page
│   │   ├── layout.tsx             # App layout
│   │   └── globals.css            # Global styles
│   ├── package.json
│   └── Dockerfile
├── init-db/
│   └── musicdb_dump.sql           # Database initialization
├── docker-compose.yml
├── run.ps1                        # Windows startup script
└── README.md
```

## API Reference

### Search for Similar Songs

**Endpoint**: `POST /api/search`

**Request Body**:
```json
{
  "artist": "Artist Name",
  "title": "Song Title"
}
```

**Response**:
```json
{
  "status": "success",
  "songs": [
    {
      "id": 1,
      "title": "Similar Song 1",
      "artist": "Artist 1"
    },
    {
      "id": 2,
      "title": "Similar Song 2",
      "artist": "Artist 2"
    }
  ]
}
```

### Health Check

**Endpoint**: `GET /api/hello`

**Response**:
```json
{
  "message": "Hello from FastAPI!"
}
```

## Database Schema

### Songs Table

| Column    | Type        | Description                   |
|-----------|-------------|-------------------------------|
| id        | INTEGER     | Primary key                   |
| title     | VARCHAR     | Song title                    |
| artist    | VARCHAR     | Artist name                   |
| embedding | VECTOR(512) | OpenL3 audio embedding vector |

The `embedding` column uses pgvector's `VECTOR` type to store 512-dimensional embeddings generated by OpenL3.

## Development

### Running Locally Without Docker

**Backend**:
```bash
cd backend
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**Frontend**:
```bash
cd frontend
npm install
npm run dev
```

**Database**:
```bash
# Start PostgreSQL with pgvector
docker run -d \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=password \
  -e POSTGRES_DB=musicdb \
  -p 5432:5432 \
  pgvector/pgvector:pg17
```

### Populating the Database

1. Place audio files in `backend/app/data/fma_small/`
2. Run the population script:
```bash
cd backend
python app/populate_db.py
```

This will:
- Extract audio features using OpenL3
- Generate 512-dimensional embeddings
- Store songs and embeddings in PostgreSQL

### Environment Variables

**Backend** (set in `docker-compose.yml`):
```
DATABASE_URL=postgresql://postgres:password@db:5432/musicdb
```

## How It Works

1. **Audio Processing**: Songs are processed using OpenL3, a pre-trained deep neural network that converts audio into 512-dimensional embeddings capturing acoustic characteristics

2. **Vector Storage**: Embeddings are stored in PostgreSQL using the pgvector extension, which enables efficient similarity search operations

3. **Similarity Search**: When a user searches for a song:
   - The system retrieves the song's embedding from the database
   - Calculates L2 distance between the query embedding and all other embeddings
   - Returns the top N most similar songs (closest in vector space)

4. **Vector Distance**: L2 (Euclidean) distance measures similarity in embedding space:
   ```python
   Song.embedding.l2_distance(query_embedding)
   ```

## Performance Considerations

- **Indexing**: pgvector supports HNSW and IVFFlat indexes for faster similarity search on large datasets
- **Embedding Cache**: Pre-computed embeddings eliminate real-time audio processing overhead
- **Batch Processing**: Population script processes songs in batches for efficiency

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## Future Enhancements

- [ ] Add audio file upload and real-time embedding generation
- [ ] Implement genre-based filtering
- [ ] Add user authentication and personalized playlists
- [ ] Create embedding visualizations using t-SNE or UMAP
- [ ] Implement approximate nearest neighbor search for larger datasets
- [ ] Add support for additional audio features (tempo, key, mood)
- [ ] Build recommendation explanations (why songs are similar)

## Resources

- [OpenL3 Paper](https://github.com/marl/openl3) - Look, Listen, and Learn More
- [pgvector Documentation](https://github.com/pgvector/pgvector) - PostgreSQL vector extension
- [Free Music Archive](https://github.com/mdeff/fma) - Dataset information
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Next.js Documentation](https://nextjs.org/docs)

## License

This project is available for educational and personal use.

## Acknowledgments

- Free Music Archive for providing the music dataset
- OpenL3 team for the audio embedding model
- pgvector contributors for the PostgreSQL extension
